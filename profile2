# Terminate processes running under the admin profile
$adminUsername = "YourAdminName"  # Replace with your admin profile's username
$processes = Get-Process -IncludeUserName | Where-Object { $_.UserName -eq "DOMAIN\$adminUsername" -or $_.UserName -eq $adminUsername }
foreach ($proc in $processes) {
    Stop-Process -Id $proc.Id -Force
}

# Wait for 10 seconds to ensure processes have fully terminated
Start-Sleep -Seconds 10

# Delete the admin profile
$profiles = Get-CimInstance -ClassName Win32_UserProfile
foreach ($profile in $profiles) {
    if (-not $profile.Special) {  # Exclude special profiles like SYSTEM or Default
        $path = $profile.LocalPath
        $username = $path -split '\\' | Select-Object -Last 1
        if ($username -eq $adminUsername) {
            $profile | Remove-CimInstance
        }
    }
}